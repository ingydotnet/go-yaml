# Copyright 2025 The go-yaml Project Contributors
# SPDX-License-Identifier: Apache-2.0

# Error type tests
#
# Purpose: Tests YAML error types and their formatting
#
# Format: Test cases use type-as-key format:
#   - test-type:
#       name: Test case name
#       from: input error data
#       want: expected error string output
#       also: unwrap  # (optional) test that Unwrap() returns underlying error
#
# Test Types:
#   load-error       - Tests LoadError formatting with different stages
#   emitter-error    - Tests EmitterError formatting (dump stack)
#   writer-error     - Tests WriterError formatting and Unwrap (dump stack)
#   construct-error  - Tests ConstructError formatting (backward compat)
#   load-errors      - Tests LoadErrors formatting
#   load-errors-as   - Tests LoadErrors.As method
#   load-errors-is   - Tests LoadErrors.Is method
#   type-error       - Tests deprecated TypeError formatting

# LoadError tests - different stages

- load-error:
    name: Reader stage error
    from:
      stage: reader
      mark:
        line: 1
        column: 2
        index: 2
      message: 'invalid UTF-8 octet (value: 255)'
      err: invalid UTF-8 octet
    want: |-
      go-yaml Load error: invalid UTF-8 octet (value: 255)
        in reader at L1,C3
    also: unwrap

- load-error:
    name: Scanner stage error
    from:
      stage: scanner
      mark:
        line: 2
        column: 5
        index: 42
      message: unexpected token
    want: |-
      go-yaml Load error: unexpected token
        in scanner at L2,C6

- load-error:
    name: Scanner stage error with context
    from:
      stage: scanner
      context_mark:
        line: 2
        column: 0
        index: 20
      context_message: while scanning a block scalar
      mark:
        line: 4
        column: 8
        index: 60
      message: found unexpected end of stream
    want: |-
      go-yaml Load error: found unexpected end of stream
        in scanner (while scanning a block scalar) at L2-L4,C9

- load-error:
    name: Parser stage error
    from:
      stage: parser
      mark:
        line: 3
        column: 10
        index: 50
      message: did not find expected key
    want: |-
      go-yaml Load error: did not find expected key
        in parser at L3,C11

- load-error:
    name: Parser stage error with context
    from:
      stage: parser
      context_mark:
        line: 1
        column: 0
        index: 0
      context_message: while parsing a block mapping
      mark:
        line: 4
        column: 5
        index: 80
      message: did not find expected key
    want: |-
      go-yaml Load error: did not find expected key
        in parser (while parsing a block mapping) at L1-L4,C6

- load-error:
    name: Composer stage error
    from:
      stage: composer
      mark:
        line: 1
        column: 4
        index: 4
      message: unknown anchor 'foo' referenced
    want: |-
      go-yaml Load error: unknown anchor 'foo' referenced
        in composer at L1,C5

- load-error:
    name: Resolver stage error
    from:
      stage: resolver
      mark:
        line: 1
        column: 0
        index: 0
      message: cannot construct !!str `error` as a !!float
    want: |-
      go-yaml Load error: cannot construct !!str `error` as a !!float
        in resolver at L1

- load-error:
    name: Constructor stage error
    from:
      stage: constructor
      mark:
        line: 1
        column: 0
        index: 0
      message: cannot construct !!map into string
      err: cannot construct !!map into string
    want: |-
      go-yaml Load error: cannot construct !!map into string
        in constructor at L1
    also: unwrap

# EmitterError tests (dump stack)

- emitter-error:
    name: Basic emitter error
    from:
      message: expected STREAM-START
    want: 'yaml: expected STREAM-START'

# WriterError tests (dump stack)

- writer-error:
    name: Writer error with unwrap
    from:
      message: write error
    want: 'yaml: write error'
    also: unwrap

# ConstructError tests (backward compatibility)

- construct-error:
    name: Basic construct error
    from:
      line: 5
      message: type mismatch
    want: 'line 5: type mismatch'
    also: unwrap

- construct-error:
    name: Construct error line 0
    from:
      line: 0
      message: unknown error
    want: 'line 0: unknown error'
    also: unwrap

# LoadErrors tests

- load-errors:
    name: Single error
    from:
      errors:
      - line: 3
        message: field not found
    want: |-
      yaml: construct errors:
        line 3: field not found

- load-errors:
    name: Multiple errors
    from:
      errors:
      - line: 5
        message: field 'foo' not found in type struct
      - line: 8
        message: field 'bar' not found in type struct
    want: |-
      yaml: construct errors:
        line 5: field 'foo' not found in type struct
        line 8: field 'bar' not found in type struct

# LoadErrors.As tests

- load-errors-as:
    name: As ConstructError
    from:
      errors:
      - line: 10
        message: conversion failed
    as: ConstructError
    want_as: true
    want_line: 10
    want_message: conversion failed

- load-errors-as:
    name: As TypeError
    from:
      errors:
      - line: 3
        message: first error
      - line: 7
        message: second error
    as: TypeError
    want_as: true
    want_messages:
    - 'line 3: first error'
    - 'line 7: second error'

# LoadErrors.Is tests

- load-errors-is:
    name: Contains error
    from:
      errors:
      - line: 5
        message: target error
    is: target error
    want_is: true

- load-errors-is:
    name: Does not contain error
    from:
      errors:
      - line: 5
        message: different error
    is: target error
    want_is: false

# TypeError tests (backward compatibility)

- type-error:
    name: Single type error
    from:
      errors:
      - field not found
    want: |-
      yaml: unmarshal errors:
        field not found

- type-error:
    name: Multiple type errors
    from:
      errors:
      - 'line 3: first error'
      - 'line 5: second error'
    want: |-
      yaml: unmarshal errors:
        line 3: first error
        line 5: second error
