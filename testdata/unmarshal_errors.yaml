# Copyright 2025 The go-yaml Project Contributors
# SPDX-License-Identifier: Apache-2.0

# Unmarshal error test cases for go-yaml
#
# Purpose: Tests that the YAML unmarshaler correctly detects and reports errors
# for invalid YAML input, malformed syntax, and type conversion failures.
#
# Format: Test cases use type-as-key format:
#   - test-type:
#       name: Test case name
#       ...
#
# Test Types:
#   unmarshal-error - Verifies that unmarshaling produces the expected error message
#
# Common Keys:
#   name - Test case name (string)
#   yaml - Invalid or malformed YAML input (string)
#   want - Expected error message (string)
#
# Note:
#   All tests in this file expect unmarshaling to fail. The 'want' field contains
#   the exact error message that should be produced.

- unmarshal-error:
    name: Invalid float value
    yaml: 'v: !!float ''error'''
    want: |-
      go-yaml Load error: cannot construct !!str `error` as a !!float
        in resolver at <unknown position>

- unmarshal-error:
    name: Incomplete flow sequence
    yaml: 'v: [A,'
    want: |-
      go-yaml Load error: did not find expected node content
        in parser (while parsing a flow node) at L1

- unmarshal-error:
    name: Incomplete flow sequence in list
    yaml: |
      v:
      - [A,
    want: |-
      go-yaml Load error: did not find expected node content
        in parser (while parsing a flow node) at L2

- unmarshal-error:
    name: Invalid alias syntax
    yaml: |
      a:
      - b: *,
    want: |-
      go-yaml Load error: did not find expected alphabetic or numeric character
        in scanner (while scanning an alias) at L2,C6-C7

- unmarshal-error:
    name: Unknown anchor referenced
    yaml: "a: *b\n"
    want: |-
      go-yaml Load error: unknown anchor 'b' referenced
        in composer at L1,C5

- unmarshal-error:
    name: Anchor contains itself
    yaml: |
      a: &a
        b: *a
    want: |-
      go-yaml Load error: anchor 'a' value contains itself
        in composer at L2,C7

- unmarshal-error:
    name: Block sequence in invalid context
    yaml: 'value: -'
    want: |-
      go-yaml Load error: block sequence entries are not allowed in this context
        in scanner at L1,C8

- unmarshal-error:
    name: Invalid base64 in binary
    yaml: 'a: !!binary =='
    want: |-
      go-yaml Load error: !!binary value contains invalid base64 data
        in constructor at L1,C5

- unmarshal-error:
    name: Slice as map key
    yaml: '{[.]}'
    want: |-
      go-yaml Load error: cannot use '[]interface {}{"."}' as a map key; try decoding into yaml.Node
        in constructor at L1,C3

- unmarshal-error:
    name: Map as map key
    yaml: '{{.}}'
    want: |-
      go-yaml Load error: cannot use 'map[string]interface {}{".":interface {}(nil)}' as a map key; try decoding into yaml.Node
        in constructor at L1,C3

- unmarshal-error:
    name: Forward reference to anchor
    yaml: |
      b: *a
      a: &a {c: 1}
    want: |-
      go-yaml Load error: unknown anchor 'a' referenced
        in composer at L1,C5

- unmarshal-error:
    name: Invalid TAG directive
    yaml: |
      %TAG !%79! tag:yaml.org,2002:
      ---
      v: !%79!int '1'
    want: |-
      go-yaml Load error: did not find expected whitespace
        in scanner (while scanning a %TAG directive) at L1-L1,C7

- unmarshal-error:
    name: Missing colon in mapping (multiline)
    yaml: |
      a:
        1:
      b
        2:
    want: |-
      go-yaml Load error: mapping values are not allowed in this context
        in scanner at L4,C4

- unmarshal-error:
    name: Missing colon in mapping (inline)
    yaml: |
      a: 1
      b: 2
      c 2
      d: 3
    want: |-
      go-yaml Load error: could not find expected ':'
        in scanner (while scanning a simple key) at L3-L4

- unmarshal-error:
    name: Missing colon after comment and list (Issue 665)
    yaml: |
      #
      -
      {
    want: |-
      go-yaml Load error: did not find expected node content
        in parser (while parsing a flow node) at L3

- unmarshal-error:
    name: Incomplete UTF-8 sequence (Issue 666)
    yaml: "0: [:!00 \xEF"
    want: |-
      go-yaml Load error: did not find expected ',' or ']'
        in parser (while parsing a flow sequence) at <unknown position>-L1

- unmarshal-error:
    name: Anchor with colon (Issue 109)
    yaml: |
      foo: &bar: bar
      *bar: : quz
    want: |-
      go-yaml Load error: mapping values are not allowed in this context
        in scanner at L1,C10

- unmarshal-error:
    name: Excessive aliasing
    yaml: |
      a: &a [00,00,00,00,00,00,00,00,00]
      b: &b [*a,*a,*a,*a,*a,*a,*a,*a,*a]
      c: &c [*b,*b,*b,*b,*b,*b,*b,*b,*b]
      d: &d [*c,*c,*c,*c,*c,*c,*c,*c,*c]
      e: &e [*d,*d,*d,*d,*d,*d,*d,*d,*d]
      f: &f [*e,*e,*e,*e,*e,*e,*e,*e,*e]
      g: &g [*f,*f,*f,*f,*f,*f,*f,*f,*f]
      h: &h [*g,*g,*g,*g,*g,*g,*g,*g,*g]
      i: &i [*h,*h,*h,*h,*h,*h,*h,*h,*h]
    want: |-
      go-yaml Load error: document contains excessive aliasing
        in constructor at L2,C18

# TextUnmarshaler validation errors

- unmarshal-error:
    name: Mapping into TextUnmarshaler (value field)
    type: testStructA_TextUnmarshaler
    yaml: 'a: {foo: bar}'
    want: |-
      yaml: construct errors:
        line 1: cannot construct !!map into yaml_test.simpleTextUnmarshaler (TextUnmarshaler)

- unmarshal-error:
    name: Sequence into TextUnmarshaler (value field)
    type: testStructA_TextUnmarshaler
    yaml: 'a: [foo, bar]'
    want: |-
      yaml: construct errors:
        line 1: cannot construct !!seq into yaml_test.simpleTextUnmarshaler (TextUnmarshaler)

- unmarshal-error:
    name: Mapping into TextUnmarshaler (pointer field)
    type: testStructA_TextUnmarshalerPtr
    yaml: 'a: {foo: bar}'
    want: |-
      yaml: construct errors:
        line 1: cannot construct !!map into *yaml_test.simpleTextUnmarshaler (TextUnmarshaler)

- unmarshal-error:
    name: Sequence into TextUnmarshaler (pointer field)
    type: testStructA_TextUnmarshalerPtr
    yaml: 'a: [foo, bar]'
    want: |-
      yaml: construct errors:
        line 1: cannot construct !!seq into *yaml_test.simpleTextUnmarshaler (TextUnmarshaler)

- unmarshal-error:
    name: Mapping into TextUnmarshaler (pointer-pointer field)
    type: testStructA_TextUnmarshalerPtrPtr
    yaml: 'a: {foo: bar}'
    want: |-
      yaml: construct errors:
        line 1: cannot construct !!map into **yaml_test.simpleTextUnmarshaler (TextUnmarshaler)

- unmarshal-error:
    name: Sequence into TextUnmarshaler (pointer-pointer field)
    type: testStructA_TextUnmarshalerPtrPtr
    yaml: 'a: [foo, bar]'
    want: |-
      yaml: construct errors:
        line 1: cannot construct !!seq into **yaml_test.simpleTextUnmarshaler (TextUnmarshaler)
